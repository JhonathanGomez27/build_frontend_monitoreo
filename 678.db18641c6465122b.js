"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[678],{4678:(ut,Z,s)=>{s.r(Z),s.d(Z,{default:()=>lt});var h=s(6814),p=s(2296),g=s(617),C=s(1476),m=s(5313),U=s(553),n=s(6223),d=s(7700),f=s(4170),T=s(4516),A=s(8525),J=s(9796),y=s(8645),_=s(9773),Q=s(3519),x=s.n(Q),t=s(9212),b=s(1474),q=s(5619),N=s(9397);let v=(()=>{class e{constructor(){this.url=U.N.url,this.limit=U.N.pagination,this._httpCliente=(0,t.f3M)(b.eN),this._usuarios=new q.X(null)}set usuarios(o){this._usuarios.next(o)}get usuarios$(){return this._usuarios.asObservable()}getAllUsuarios(o){let i=new b.LE;return i=i.append("page",o),i=i.append("limit",this.limit),this._httpCliente.get(`${this.url}usuarios/all`,{params:i}).pipe((0,N.b)(a=>{this._usuarios.next(a)}))}getUsuariosPaginated(o){let i=new b.LE;return i=i.append("page",o),i=i.append("limit",this.limit),this._httpCliente.get(`${this.url}usuarios/all`,{params:i})}createUsuario(o){return this._httpCliente.post(`${this.url}usuarios/create`,o)}updateUsuario(o,i){return this._httpCliente.patch(`${this.url}usuarios/editar/${i}`,o)}static#t=this.\u0275fac=function(i){return new(i||e)};static#e=this.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var F=s(3680);function D(e,r){1&e&&(t.TgZ(0,"mat-error"),t._uU(1," El apellido es requerido. "),t.qZA())}function R(e,r){1&e&&(t.TgZ(0,"mat-error"),t._uU(1," El correo es requerido. "),t.qZA())}function M(e,r){1&e&&(t.TgZ(0,"mat-error"),t._uU(1," Ingresa un correo electronico valido. "),t.qZA())}function Y(e,r){1&e&&t._UZ(0,"mat-icon",20),2&e&&t.Q6J("svgIcon","heroicons_solid:eye")}function k(e,r){1&e&&t._UZ(0,"mat-icon",20),2&e&&t.Q6J("svgIcon","heroicons_solid:eye-slash")}function E(e,r){1&e&&(t.TgZ(0,"mat-error"),t._uU(1," La contrase\xf1a es requerida "),t.qZA())}function S(e,r){1&e&&(t.TgZ(0,"mat-error"),t._uU(1," La contrase\xf1a debe tener al menos 6 caracteres "),t.qZA())}function B(e,r){1&e&&t._UZ(0,"mat-icon",20),2&e&&t.Q6J("svgIcon","heroicons_solid:eye")}function O(e,r){1&e&&t._UZ(0,"mat-icon",20),2&e&&t.Q6J("svgIcon","heroicons_solid:eye-slash")}function P(e,r){1&e&&(t.TgZ(0,"mat-error"),t._uU(1," La confirmacion de la contrase\xf1a es requerida "),t.qZA())}function $(e,r){1&e&&(t.TgZ(0,"mat-error"),t._uU(1," Las contrase\xf1as deben coincidir "),t.qZA())}let I=(()=>{class e{constructor(o,i,a,l,u){this.data=o,this.dialogRef=i,this._formBuilder=a,this._changeDetectorRef=l,this._usuariosService=u,this._unsubscribeAll=new y.x,this.title="",this.showData=!1,this.usuario={},this.Toast=x().mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:c=>{c.addEventListener("mouseenter",x().stopTimer),c.addEventListener("mouseleave",x().resumeTimer)}})}ngOnInit(){if(this.title=this.data.title,this.usuarioForm=this._formBuilder.group({nombre:["",n.kI.required],apellido:["",n.kI.required],correo:["",n.kI.compose([n.kI.required,n.kI.email])],rol:["",n.kI.required],password:["",n.kI.compose([n.kI.required,n.kI.minLength(6)])],passwordConfirm:["",n.kI.required]},{validators:J.a.mustMatch("password","passwordConfirm")}),"edit"===this.data.action){this.usuario=this.data.usuario;const o=this.data.usuario;this.usuarioForm.patchValue({nombre:o.nombre,apellido:o.apellido,correo:o.email,rol:o.rol,password:"",passwordConfirm:""})}}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}cerrarDialogo(){this.dialogRef.close("cancelar")}guardarUsuario(){if(!this.usuarioForm.valid)return void this.Toast.fire({icon:"error",title:"Debes completar todos los campos."});this.usuarioForm.disable();const o=this.usuarioForm.value;let i={email:o.correo,nombre:o.nombre,apellido:o.apellido,rol:o.rol,password:o.password};"create"===this.data.action?this.crearUsuario(i):this.editarUsuario(i)}crearUsuario(o){this._usuariosService.createUsuario(o).pipe((0,_.R)(this._unsubscribeAll)).subscribe(i=>{i.ok?(this.Toast.fire({icon:"success",title:i.message}),this.dialogRef.close("exito")):(this.Toast.fire({icon:"error",title:i.message}),this.usuarioForm.enable())},i=>{this.Toast.fire({icon:"error",title:i.error.message}),this.usuarioForm.enable()})}editarUsuario(o){this._usuariosService.updateUsuario(o,this.usuario.id).pipe((0,_.R)(this._unsubscribeAll)).subscribe(i=>{i.ok?(this.Toast.fire({icon:"success",title:i.message}),this.dialogRef.close("exito")):(this.Toast.fire({icon:"error",title:i.message}),this.usuarioForm.enable())},i=>{this.Toast.fire({icon:"error",title:i.error.message}),this.usuarioForm.enable()})}static#t=this.\u0275fac=function(i){return new(i||e)(t.Y36(d.WI),t.Y36(d.so),t.Y36(n.qu),t.Y36(t.sBO),t.Y36(v))};static#e=this.\u0275cmp=t.Xpm({type:e,selectors:[["app-usuario-modal"]],standalone:!0,features:[t.jDz],decls:69,vars:29,consts:[["mat-dialog-title","",1,"flex","text-primary-600","font-bold","text-3xl"],[1,"w-full"],["autocomplete","false",3,"formGroup"],["id","nombre","type","text","matInput","","required","",3,"formControlName"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["id","apellido","type","text","matInput","","required","","autocomplete","one-time-code","role","presentation",3,"formControlName"],[4,"ngIf"],["id","field-1","name","field-1","type","email","matInput","","required","","autocomplete","one-time-code","role","presentation",3,"formControlName"],["required","",3,"formControlName"],["disabled","",3,"value"],[3,"value"],["id","field-2","name","field-2","matInput","","type","password","autocomplete","one-time-code","role","presentation",3,"formControlName"],["passwordField",""],["mat-icon-button","","type","button","matSuffix","",3,"click"],["class","icon-size-5",3,"svgIcon",4,"ngIf"],["id","field-2-confirm","name","field-2","matInput","","type","password","autocomplete","one-time-code","role","presentation",3,"formControlName"],["passwordConfirmField",""],[1,"flex","justify-between","mt-4"],["mat-button","",1,"text-black","hover:bg-black","hover:text-white","border-2","rounded-md","border-solid",3,"click"],["mat-flat-button","",1,"text-white","hover:bg-white","hover:text-primary-600","border-2","rounded-md","hover:border-solid",3,"color","click"],[1,"icon-size-5",3,"svgIcon"]],template:function(i,a){if(1&i){const l=t.EpF();t.TgZ(0,"h2",0),t._uU(1),t.qZA(),t.TgZ(2,"mat-dialog-content")(3,"div",1)(4,"form",2)(5,"div")(6,"mat-form-field",1)(7,"mat-label"),t._uU(8,"Nombre"),t.qZA(),t._UZ(9,"input",3)(10,"mat-icon",4),t.qZA()(),t.TgZ(11,"div")(12,"mat-form-field",1)(13,"mat-label"),t._uU(14,"Apellido"),t.qZA(),t._UZ(15,"input",5)(16,"mat-icon",4),t.YNc(17,D,2,0,"mat-error",6),t.qZA()(),t.TgZ(18,"div")(19,"mat-form-field",1)(20,"mat-label"),t._uU(21,"Correo electronico"),t.qZA(),t._UZ(22,"input",7)(23,"mat-icon",4),t.YNc(24,R,2,0,"mat-error",6)(25,M,2,0,"mat-error",6),t.qZA()(),t.TgZ(26,"div")(27,"mat-form-field",1)(28,"mat-label"),t._uU(29,"Rol"),t.qZA(),t.TgZ(30,"mat-select",8)(31,"mat-option",9),t._uU(32," Seleccionar Rol "),t.qZA(),t.TgZ(33,"mat-option",10),t._uU(34," Administrador "),t.qZA(),t.TgZ(35,"mat-option",10),t._uU(36," Programador "),t.qZA(),t.TgZ(37,"mat-option",10),t._uU(38," Operario "),t.qZA(),t.TgZ(39,"mat-option",10),t._uU(40," Monitor "),t.qZA()(),t._UZ(41,"mat-icon",4),t.qZA()(),t.TgZ(42,"div")(43,"mat-form-field",1)(44,"mat-label"),t._uU(45,"Contrase\xf1a"),t.qZA(),t._UZ(46,"input",11,12),t.TgZ(48,"button",13),t.NdJ("click",function(){t.CHM(l);const c=t.MAs(47);return t.KtG(c.type="password"===c.type?"text":"password")}),t.YNc(49,Y,1,1,"mat-icon",14)(50,k,1,1,"mat-icon",14),t.qZA(),t.YNc(51,E,2,0,"mat-error",6)(52,S,2,0,"mat-error",6),t.qZA()(),t.TgZ(53,"div")(54,"mat-form-field",1)(55,"mat-label"),t._uU(56,"Confirmar contrase\xf1a"),t.qZA(),t._UZ(57,"input",15,16),t.TgZ(59,"button",13),t.NdJ("click",function(){t.CHM(l);const c=t.MAs(58);return t.KtG(c.type="password"===c.type?"text":"password")}),t.YNc(60,B,1,1,"mat-icon",14)(61,O,1,1,"mat-icon",14),t.qZA(),t.YNc(62,P,2,0,"mat-error",6)(63,$,2,0,"mat-error",6),t.qZA()()()()(),t.TgZ(64,"mat-dialog-actions",17)(65,"button",18),t.NdJ("click",function(){return a.cerrarDialogo()}),t._uU(66,"Cancelar"),t.qZA(),t.TgZ(67,"button",19),t.NdJ("click",function(){return a.guardarUsuario()}),t._uU(68,"Guardar"),t.qZA()()}if(2&i){const l=t.MAs(47),u=t.MAs(58);t.xp6(1),t.Oqu(a.title),t.xp6(3),t.Q6J("formGroup",a.usuarioForm),t.xp6(5),t.Q6J("formControlName","nombre"),t.xp6(1),t.Q6J("svgIcon","mat_outline:person_outline"),t.xp6(5),t.Q6J("formControlName","apellido"),t.xp6(1),t.Q6J("svgIcon","mat_outline:person_outline"),t.xp6(1),t.Q6J("ngIf",a.usuarioForm.get("apellido").hasError("required")),t.xp6(5),t.Q6J("formControlName","correo"),t.xp6(1),t.Q6J("svgIcon","mat_outline:person_outline"),t.xp6(1),t.Q6J("ngIf",a.usuarioForm.get("correo").hasError("required")),t.xp6(1),t.Q6J("ngIf",a.usuarioForm.get("correo").hasError("email")),t.xp6(5),t.Q6J("formControlName","rol"),t.xp6(1),t.Q6J("value",""),t.xp6(2),t.Q6J("value","admin"),t.xp6(2),t.Q6J("value","programador"),t.xp6(2),t.Q6J("value","operario"),t.xp6(2),t.Q6J("value","monitor"),t.xp6(2),t.Q6J("svgIcon","heroicons_solid:users"),t.xp6(5),t.Q6J("formControlName","password"),t.xp6(3),t.Q6J("ngIf","password"===l.type),t.xp6(1),t.Q6J("ngIf","text"===l.type),t.xp6(1),t.Q6J("ngIf",a.usuarioForm.get("password").hasError("required")),t.xp6(1),t.Q6J("ngIf",a.usuarioForm.get("password").hasError("minlength")),t.xp6(5),t.Q6J("formControlName","passwordConfirm"),t.xp6(3),t.Q6J("ngIf","password"===u.type),t.xp6(1),t.Q6J("ngIf","text"===u.type),t.xp6(1),t.Q6J("ngIf",a.usuarioForm.get("passwordConfirm").hasError("required")),t.xp6(1),t.Q6J("ngIf",a.usuarioForm.get("passwordConfirm").hasError("mustMatch")),t.xp6(4),t.Q6J("color","primary")}},dependencies:[h.ez,h.O5,d.Is,d.uh,d.H8,d.xY,p.ot,p.lW,p.RK,g.Ps,g.Hw,n.u5,n._Y,n.Fj,n.JJ,n.JL,n.Q7,f.lN,f.KE,f.hX,f.TO,f.qo,f.R9,n.UX,n.sg,n.u,T.c,T.Nt,A.LD,A.gD,F.ey],encapsulation:2})}return e})();var j=s(6593),w=s(8109);function z(e,r){1&e&&(t.TgZ(0,"th",21),t._uU(1," Id "),t.qZA())}function L(e,r){if(1&e&&(t.TgZ(0,"td",22),t._uU(1),t.qZA()),2&e){const o=r.$implicit;t.xp6(1),t.hij(" ",o.id," ")}}function H(e,r){1&e&&(t.TgZ(0,"th",21),t._uU(1," Nombre "),t.qZA())}function G(e,r){if(1&e&&(t.TgZ(0,"td",22),t._uU(1),t.qZA()),2&e){const o=r.$implicit;t.xp6(1),t.AsE(" ",o.nombre," ",o.apellido,"")}}function K(e,r){1&e&&(t.TgZ(0,"th",21),t._uU(1," Correo "),t.qZA())}function X(e,r){if(1&e&&(t.TgZ(0,"td",22),t._uU(1),t.qZA()),2&e){const o=r.$implicit;t.xp6(1),t.hij(" ",o.email," ")}}function W(e,r){1&e&&(t.TgZ(0,"th",21),t._uU(1," Rol "),t.qZA())}function V(e,r){if(1&e&&(t.TgZ(0,"td",22),t._uU(1),t.qZA()),2&e){const o=r.$implicit;t.xp6(1),t.hij(" ",o.rol," ")}}function tt(e,r){1&e&&(t.TgZ(0,"th",21),t._uU(1," Online "),t.qZA())}function et(e,r){1&e&&t._UZ(0,"span",25)}function ot(e,r){1&e&&t._UZ(0,"span",26)}function it(e,r){if(1&e&&(t.TgZ(0,"td",22),t.YNc(1,et,1,0,"span",23)(2,ot,1,0,"span",24),t.qZA()),2&e){const o=r.$implicit;t.xp6(1),t.Q6J("ngIf",o.login_status),t.xp6(1),t.Q6J("ngIf",!o.login_status)}}function rt(e,r){1&e&&t._UZ(0,"th",21)}function at(e,r){if(1&e){const o=t.EpF();t.TgZ(0,"td",22)(1,"button",27),t.NdJ("click",function(){const l=t.CHM(o).$implicit,u=t.oxw();return t.KtG(u.abrirDialogoEditarUsuario(l))}),t._UZ(2,"mat-icon",6),t.qZA()()}2&e&&(t.xp6(2),t.Q6J("svgIcon","heroicons_outline:pencil"))}function st(e,r){1&e&&t._UZ(0,"tr",28)}function nt(e,r){1&e&&t._UZ(0,"tr",29)}const lt=[{path:"",component:(()=>{class e{constructor(o,i,a,l,u,c){this.titleService=o,this.dialog=i,this._changeDetectorRef=a,this._usuariosService=l,this.router=u,this.activatedRoute=c,this._unsubscribeAll=new y.x,this.displayedColumns=["id","nombre","rol","correo","online","acciones"],this.dataSource=new m.by([]),this.totalUsuarios=0,this.page=0,this.limit=U.N.pagination,this.loading=!1,this.titleService.setTitle("Relator\xeda | Usuarios")}ngOnInit(){this._usuariosService.usuarios$.pipe((0,_.R)(this._unsubscribeAll)).subscribe(o=>{this.dataSource=new m.by(o.data),this.totalUsuarios=o.total,this._changeDetectorRef.markForCheck()}),this.router.navigate([],{relativeTo:this.activatedRoute,queryParams:{page:"1"}})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}ngAfterViewInit(){}getUsuariosPaginated(o){this._usuariosService.getUsuariosPaginated(o).pipe((0,_.R)(this._unsubscribeAll)).subscribe(i=>{this._usuariosService.usuarios=i,this.loading=!1,this._changeDetectorRef.markForCheck()},i=>{this.loading=!1,this._changeDetectorRef.markForCheck()})}handlePageEvent(o){let i=o.pageIndex+1;this.page=o.pageIndex,this.loading=!0,this.getUsuariosPaginated(i)}abrirDialogoCrearUsuario(){this.dialog.open(I,{disableClose:!0,width:"500px",data:{action:"create",title:"Crear usuario"}}).afterClosed().subscribe(i=>{"cancelar"!==i&&this.getUsuariosPaginated(this.page+1)})}abrirDialogoEditarUsuario(o){this.dialog.open(I,{disableClose:!0,width:"500px",data:{action:"edit",title:"Editar usuario",usuario:o}}).afterClosed().subscribe(a=>{"cancelar"!==a&&this.getUsuariosPaginated(this.page+1)})}static#t=this.\u0275fac=function(i){return new(i||e)(t.Y36(j.Dx),t.Y36(d.uw),t.Y36(t.sBO),t.Y36(v),t.Y36(w.F0),t.Y36(w.gz))};static#e=this.\u0275cmp=t.Xpm({type:e,selectors:[["app-usuarios"]],standalone:!0,features:[t.jDz],decls:33,vars:7,consts:[["cdkScrollable","",1,"absolute","inset-0","flex","flex-col","min-w-0","overflow-y-auto","bg-white"],[1,"flex-auto","p-6","sm:px-26","sm:py-10"],[1,"min-h-100"],[1,"flex","flex-col","sm:flex-row","sm:justify-between","sm:items-center","items-start","mb-6","w-full","p-4"],[1,"text-4xl","font-semibold","text-primary-700"],["mat-flat-button","",1,"group","border-solid","border-2","rounded-md","border-primary","hover:bg-primary","hover:text-white","text-primary","font-semibold",3,"click"],[3,"svgIcon"],[1,"overflow-x-auto"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","nombre"],["matColumnDef","correo"],["matColumnDef","rol"],["matColumnDef","online"],["matColumnDef","acciones"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"w-full","flex","justify-end"],["aria-label","Seleccionar pagina de usuarios","showFirstLastButtons","true",3,"length","pageSize","pageIndex","page"],["mat-header-cell",""],["mat-cell",""],["class","text-xs font-semibold rounded-full px-2.5 py-1 bg-green-400",4,"ngIf"],["class","text-xs font-semibold rounded-full px-2.5 py-1 bg-red-400",4,"ngIf"],[1,"text-xs","font-semibold","rounded-full","px-2.5","py-1","bg-green-400"],[1,"text-xs","font-semibold","rounded-full","px-2.5","py-1","bg-red-400"],["mat-icon-button","","color","primary",1,"hover:bg-gray-200",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(i,a){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),t._uU(5,"Administrador de Usuarios"),t.qZA(),t.TgZ(6,"button",5),t.NdJ("click",function(){return a.abrirDialogoCrearUsuario()}),t._UZ(7,"mat-icon",6),t._uU(8," \xa0 A\xf1adir Usuario "),t.qZA()(),t.TgZ(9,"div",7)(10,"table",8),t.ynx(11,9),t.YNc(12,z,2,0,"th",10)(13,L,2,1,"td",11),t.BQk(),t.ynx(14,12),t.YNc(15,H,2,0,"th",10)(16,G,2,2,"td",11),t.BQk(),t.ynx(17,13),t.YNc(18,K,2,0,"th",10)(19,X,2,1,"td",11),t.BQk(),t.ynx(20,14),t.YNc(21,W,2,0,"th",10)(22,V,2,1,"td",11),t.BQk(),t.ynx(23,15),t.YNc(24,tt,2,0,"th",10)(25,it,3,2,"td",11),t.BQk(),t.ynx(26,16),t.YNc(27,rt,1,0,"th",10)(28,at,3,1,"td",11),t.BQk(),t.YNc(29,st,1,0,"tr",17)(30,nt,1,0,"tr",18),t.qZA()(),t.TgZ(31,"div",19)(32,"mat-paginator",20),t.NdJ("page",function(u){return a.handlePageEvent(u)}),t.qZA()()()()()),2&i&&(t.xp6(7),t.Q6J("svgIcon","heroicons_outline:user"),t.xp6(3),t.Q6J("dataSource",a.dataSource),t.xp6(19),t.Q6J("matHeaderRowDef",a.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",a.displayedColumns),t.xp6(2),t.Q6J("length",a.totalUsuarios)("pageSize",a.limit)("pageIndex",a.page))},dependencies:[h.ez,h.O5,p.ot,p.lW,p.RK,g.Ps,g.Hw,m.p0,m.BZ,m.fO,m.as,m.w1,m.Dz,m.nj,m.ge,m.ev,m.XQ,m.Gk,C.TU,C.NW],encapsulation:2})}return e})(),resolve:{usuarios:(e,r)=>{let o=e.queryParamMap.get("page")||"1";return(0,t.f3M)(v).getAllUsuarios(o)}}}]}}]);